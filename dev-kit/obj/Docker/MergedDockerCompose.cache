networks:
  exp-appname:
    driver: bridge
services:
  consul-server:
    command: consul agent -server -ui -node=server-1 -bootstrap-expect=1 -client='0.0.0.0'
      -data-dir=/tmp/consul
    container_name: consul-server-get-start
    environment:
      CONSUL_LOCAL_CONFIG: '{"datacenter":"east-aws","data_dir":"/opt/consul","log_level":"DEBUG","node_name":"develop","server":true}'
    image: consul:latest
    networks:
      exp-appname: {}
    ports:
    - published: 8500
      target: 8500
  reverse-proxy:
    container_name: reverse-proxy
    depends_on:
    - consul-server
    image: traefik:latest
    networks:
      exp-appname: {}
    ports:
    - published: 33399
      target: 5001
    - published: 33398
      target: 8080
    volumes:
    - C:\Users\azarin.sa\Desktop\enterprise-dev-kit\dev-kit\.dev-env\reverce-proxy\traefik.toml:/etc/traefik/traefik.toml:rw
  svc:
    build:
      context: C:\Users\azarin.sa\Desktop\enterprise-dev-kit\dev-kit\.dev-env
      dockerfile: ../src/services/Svc/Svc.Implementation/Dockerfile
      labels:
        app.company: exp
        app.name: appname
    container_name: exp-appname-svc
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ServiceConfig__ServiceAddress: http://exp-appname-svc:80
      ServiceConfig__ServiceDiscoveryAddress: http://consul-server-get-start:8500
      ServiceConfig__ServiceID: exp-appname-svc
      ServiceConfig__ServiceName: exp-appname-svc
      ServiceConfig__Tags__0: traefik.enable=true
      ServiceConfig__Tags__1: traefik.tags=exposed
      ServiceConfig__Tags__2: traefik.http.routers.exp-appname-svc.rule=Host(`localhost`)
        && PathPrefix(`/exp-appname-svc`)
      ServiceConfig__Tags__3: traefik.http.middlewares.exp-appname-svc-stripprefix.stripprefix.prefixes=/exp-appname-svc
      ServiceConfig__Tags__4: traefik.http.routers.exp-appname-svc.middlewares=exp-appname-svc-stripprefix@consulcatalog
    image: exp-appname/svc
    networks:
      exp-appname: {}
    ports:
    - published: 33300
      target: 80
version: '3.4'